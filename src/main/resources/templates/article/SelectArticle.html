<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Ogani Template">
    <meta name="keywords" content="Ogani, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Ogani | Template</title>

    <div th:replace="css.html"></div>
    <style>

        .carousel .carousel-item {
            height: 500px;
        }

        .carousel .carousel-item img {
            min-height: 300px;
            max-height: 400px;
            object-fit: cover;
            border-radius: 10px;
        }

        .error {
            color: red;
            font-size: 10pt;
            font-weight:bold;
        }

        .update{
            text-decoration: none;color:#F0F0F0;background:#b08968; width: 50px;height: 40px;border-radius: 20px;
            font-size: 14px;font-family: Microsoft YaHei;padding: 12px;border: #F0F0F0;text-align:center;
        }
    </style>
</head>

<body>
<div th:replace="header.html"></div>
<div th:replace="menu.html"></div>


<!-- Breadcrumb Section Begin -->
<div class="container">
    <div class="carousel slide"  data-ride="carousel" id="carousel-demo">
        <ol class="carousel-indicators">
            <li data-target="#carousel-demo" data-slide-to="0" class="active"></li>
            <li data-target="#carousel-demo" data-slide-to="1"></li>
            <li data-target="#carousel-demo" data-slide-to="2"></li>
        </ol>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="d-block w-100" src="/img/blog/details/IMG_6351.JPG" alt="">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="/img/blog/details/lemon.jpg" alt="">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="/img/blog/details/IMG_6279.JPG" alt="">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="/img/blog/details/madeleine.jpg" alt="">
            </div>

            <a href="#carousel-demo" class="carousel-control-prev" data-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </a>
            <a href="#carousel-demo" class="carousel-control-next" data-slide="next">
                <span class="carousel-control-next-icon"></span>
            </a>
        </div>
    </div>
</div>






<!-- Breadcrumb Section End -->

<!-- Blog Section Begin -->
<section class="blog spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-5">
                <div class="blog__sidebar">
                    <div class="blog__sidebar__search">
                        <form th:action="@{/FrontArticle/SelectArticle}" method="get" enctype="multipart/form-data">
                            <input name="title" type="text" placeholder="搜尋標題">
                            <button type="submit"><span class="icon_search"></span></button>
                        </form>
                    </div>
                    <div class="blog__sidebar__item">
                        <h4>文章分類</h4>

                        <div class="form-group">
                            <label for="type"></label>
                            <select name="type" class="form-control" id="typeSelect">
                                <option value= null label="請選擇分類">請選擇分類</option>
                                <option value="活動資訊">活動資訊</option>
                                <option value="課程資訊">課程資訊</option>
                                <option value="食譜討論">食譜討論</option>
                            </select>

                        </div>
                        <!--                        <ul>-->
                        <!--                            <li><a href="@{/SelectArticle(title=${article.title})}">活動資訊</a></li>-->
                        <!--                            <li><a href="#">課程資訊</a></li>-->
                        <!--                            <li><a href="#">食譜討論</a></li>-->
                        <!--                        </ul>-->
                    </div>
                    <div class="blog__sidebar__item">
                        <h4>最新文章</h4>
                        <form action="/" method="get" th:each="article: ${articleDate}">
                            <div class="blog__sidebar__recent">
                                <a th:href="@{/FrontArticle/ArticleDetail(postid=${article.postid})}" class="blog__sidebar__recent__item">
                                    <div class="blog__sidebar__recent__item__pic" style="width: 100px;
                              height: 100px;">
                                        <img th:src="${article.imageUrl}" alt="" style="width: 100%;
                              height: 100%;margin:auto; padding: 3px;" >
                                    </div>
                                    <div class="blog__sidebar__recent__item__text">
                                        <h6 th:text="${ article.title}"></h6>
                                        <span th:text="${ article.date}"></span>
                                    </div>
                                </a>

                            </div>
                        </form>
                    </div>
                    <div class="blog__sidebar__item">
                        <h4>HashTag</h4>
                        <div class="blog__sidebar__item__tags">
                            <a href="#">#文章</a>
                            <a href="#">#討論版</a><br>
                            <a href="#">#活動資訊</a>
                            <a href="#">#課程資訊</a>
                            <a href="#">#食譜討論</a>
                            <a href="#">#Bake Your Life</a>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-lg-8 col-md-7">
                <div class="row" id="container">
                    <div class="col-lg-6 col-md-6 col-sm-6"  th:each="article: ${articles}">
                        <div class="blog__item">
                            <div class="blog__item__pic" style="width: 200px;
                              height: 180px;">
                                <img th:src="${article.imageUrl}" style="display:block; margin:auto; border-radius:10px;width:100%; height:100%;">
                            </div>
                            <div class="blog__item__text">
                                <span></span>
                                <ul>
                                    <li><i class="fa fa-calendar-o" th:text="${ article.date}"></i></li>
                                    <li><i class="fa fa-eye" th:text="${ article.counter}"></i></li>
                                    <!--                                   <i class="fa-solid fa-book-open-cover"></i>fa fa-comment-o-->
                                </ul>
                                <h5><a th:href="@{/FrontArticle/ArticleDetail(postid=${article.postid})}" th:text="${ article.title}" style="font-family:Microsoft JhengHei 微軟正黑體,serif;">
                                </a></h5>
                                <p th:text="${ article.type}" style="font-family:Microsoft JhengHei 微軟正黑體,serif;"></p>

                                <a th:href="@{/FrontArticle/ArticleDetail(postid=${article.postid})}" class="blog__btn">觀看文章 <span class="arrow_right"></span></a>

                                <button type="button"
                                        class="update"
                                        id="favorite" th:onclick="|archiveFunction(${article.postid})|"><i class="fa-solid fa-heart"></i></button>

                                <!--                                <td><button type="button"-->
                                <!--                                            class="btn btn-danger"-->
                                <!--                                            th:onclick="|archiveFunction(${article.postid})|" id="btn">刪除貼文</button></td>-->

                            </div>
                        </div>
                    </div>

                    <!--                    <div class="row" id="container"></div>-->


                    <div class="modal fade" id="InsertArticle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">新增文章</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form action="/ArticleAdd"  method="post" enctype="multipart/form-data" id="form" >
                                        <div class="form-group">
                                            <!--                                            <input type="hidden" name="userid"  id="userid">-->
                                            <label for="title">標題:</label>
                                            <input type="text" name="title" class="form-control"  id="title">
                                        </div>

                                        <div class="form-group">
                                            <label for="type">文章分類:</label>
                                            <select name="type" class="form-control" id="type">
                                                <option value= null label="請選擇分類">請選擇分類</option>
                                                <option value="活動資訊">活動資訊</option>
                                                <option value="課程資訊">課程資訊</option>
                                                <option value="食譜討論">食譜討論</option>
                                            </select>

                                        </div>
                                        <div class="form-group">
                                            <label for="date">發文日期:</label>
                                            <input type="date" name="date" id="date">
                                        </div>
                                        <div class="form-group">
                                            <label>內文:</label>
                                            <textarea name="content" class="form-control"  id="content" cols="30"
                                                      rows="10"></textarea> <br>
                                        </div>
                                        <div class="form-group">
                                            <img width="100" height="100" style="display:block; margin:auto;" id="previewImage"/>
                                            <label for="articleImage">上傳圖片</label>
                                            <input type="file" name="articleImage" class="form-control-file" id="articleImage">
                                        </div>

                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" id="correctInput">一鍵輸入</button>
                                    <button  class="btn btn-outline-warning" id="testadd">送出文章</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="product__pagination blog__pagination">
                            <a href="#">1</a>
                            <a href="#">2</a>
                            <a href="#">3</a>
                            <a href="#"><i class="fa fa-long-arrow-right"></i></a>
                        </div>
                        <!--                        <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#InsertArticle" input style="float:right">-->
                        <!--                            新增文章-->
                        <!--                        </button>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div th:replace="footer.html"></div>



</body>
<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
<script>



    // ClassicEditor
    //     .create( document.querySelector( '#content' ) )
    //     .then( editor => {
    //         console.log( editor );
    //     } )
    //     .catch( error => {
    //         console.error( error );
    //     } );


    $(document).ready(function(){
        $("body").on("change", "#articleImage", function(e){
            var file = e.target.files[0];
            var mediabase64data;
            getBase64(file).then(
                mediabase64data => $('#previewImage').attr('src', mediabase64data)
            );
        });
    })

    function getBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }



    var selectElement = document.getElementById('typeSelect');
    var xhr2 = new XMLHttpRequest();
    var companyData = [];
    selectElement.onchange = function(){
        xhr2.onreadystatechange = function() {
            if (xhr2.readyState == 4 && xhr2.status == 200) {
                displayPageBooks(xhr2.responseText);
            }
        }
        var articleType = selectElement.options[ selectElement.selectedIndex ].value;

        xhr2.open("GET", "[[@{/ArticlesType/}]]" + articleType, true);
        xhr2.send();

        function displayPageBooks(map){
            $('#container').html('')
            var mapData = JSON.parse(map);
            let html = ''
            for(var i=0; i < mapData.length; i++){
                const append = `
                    <div class="col-lg-6 col-md-6 col-sm-6" >
                    <div class="blog__item"><div class="blog__item__pic" style="width: 200px;
                              height: 200px;"><img style="display:block; margin:auto; border-radius:10px;width:100%; height:100%;" src=${mapData[i].imageUrl}>
                     </div><div class="blog__item__text"><ul><li><i class="fa fa-calendar-o"></i>${mapData[i].date}</li><li><i class="fa fa-eye"></i>${mapData[i].counter}</li>
                                            </ul><h5><a href="/FrontArticle/ArticleDetail?postid=${mapData[i].postid}">
                                                   ${mapData[i].title}
                                           </a></h5><a href="/FrontArticle/ArticleDetail?postid=${mapData[i].postid}"
                                               class="blog__btn">觀看文章<span class="arrow_right"></span></a>
                                               <button type="button"
                                           class="update"
                                            id="favorite" onclick="archiveFunction(${mapData[i].postid})"><i class="fa-solid fa-heart"></i></button>
                            </div></div></div>`


                html = html + append
            }


            var div = document.getElementById('container');
            div.innerHTML = html;
            //$("#container").html(content);

        }
    }


    function archiveFunction(postid) {
        // var formData = new FormData($('#addFavorite')[0]);
        $.ajax({
            url: "[[@{/farvorite/addFavorite}]]" + "/" + postid,
            // data: formData,
            type: "post",
            cache: false, // 不需要cache
            processData: false, // jQuery預設會把data轉為query String, 所以要停用
            contentType: false,
            // enctype: 'multipart/form-data',
            // dataType: "json",
            // contentType: "application/json;charset=utf-8",
            success: function (msg) {
                Swal.fire(
                    '已收藏!',
                    '文章已成功收藏!',
                    'success'
                ).then((result) => {
                    if (result.isConfirmed) {
                        // location.reload();
                        // location = '/FrontArticle';
                    }
                })
            },
            error: function (msg) {
                // console.log(msg.status)
                Swal.fire({
                    icon: 'error',
                    title: '請先登入!',
                    text: '收藏前請先登入帳號 ',
                    footer: '<a href="/login"  target="_blank">點我登入</a>'
                })
            }
        });
    }



    $(document).ready(() => {
        $('.carousel').carousel({
            interval: 1000
        })

    });


</script>

</html>