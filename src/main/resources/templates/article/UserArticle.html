<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

<head>
  <meta charset="UTF-8">
  <meta name="description" content="Ogani Template">
  <meta name="keywords" content="Ogani, unica, creative, html">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>我的文章</title>
  <script>


 </script>

  <div th:replace="css.html"></div>
  <style>

    .update{
        text-decoration: none;color:#F0F0F0;background: #b08968; width: 120px;height: 50px;border-radius: 20px;
        font-size: 15px;font-family: Microsoft YaHei;padding: 19px;border: #F0F0F0;
    }

    .wrong {
        color: RED;
    }
  </style>
</head>

<body>
<div th:replace="header.html"></div>
<div th:replace="menu.html"></div>


<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-section set-bg" data-setbg="/img/blog/details/img5.png">
<!--      <img src="/img/blog/details/img4.png" alt="...">-->
      <div class="container">
          <div class="row">
              <div class="col-lg-12 text-center">
                  <div class="breadcrumb__text">
                      <h2 style="color: #1c1c1c">我的文章</h2>
                      <div class="breadcrumb__option">
<!--                          <a href="./index.html">Home</a>-->
<!--                          <span>我的文章</span>-->
                      </div>
                  </div>
              </div>
          </div>
      </div>
</section>


<div id="wrapper">


    <div id="content-wrapper" class="d-flex flex-column">

    <!-- Page Heading -->
<div class="row">
    <div class="col-lg-2 col-md-3 " style="margin: 50px;">
        <div class="blog__sidebar">
            <div class="blog__sidebar__item ">
                <h4>會員中心選單</h4>
                <ul>
                    <li><i class="fa-solid fa-address-card faIcon"></i> <a th:href="@{/User/UserData/}">會員資料</a></li>
                    <li><i class="fa-solid fa-heart faIcon"></i> <a th:href="@{/User/UserArticle/farvorite}">喜愛清單</a></li>
                    <li><i class="fa-solid fa-cart-shopping faIcon"></i> <a th:href="@{/User/order/}">購買清單</a></li>
<!--                    <li><i class="fa-solid fa-ticket faIcon"></i> <a th:href="@{/#/}">我的優惠卷</a></li>-->
                    <li><i class="fa-solid fa-school faIcon"></i> <a th:href="@{/#/}">我的課程</a></li>
                    <li><i class="fa-solid fa-table faIcon"></i> <a th:href="@{/#/}">我的租借</a></li>
                    <li><i class="fa-solid fa-book faIcon"></i> <a th:href="@{/User/UserArticle/}">我的文章</a>
                        <ol class="panel">
                            <li style="margin-left: 30px"><i class="fa-solid fa-heart faIcon"></i><a th:href="@{/User/UserArticle/farvorite}">收藏文章</a></li>
                        </ol>
                    </li>
                </ul>
            </div>
        </div>
    </div>


    <div id="th">
      <!--    <div th:replace="sidebar.html"></div>-->

      <!-- Content Wrapper -->



        <!-- Main Content -->
<!--    <div id="th">-->



                  <p class="mb-4">
                  <div>
                      <button type="button" class="update" data-toggle="modal" data-target="#InsertArticle" input style="float:top;">
                          <i class="fas fa-plus"></i>新增文章
                      </button>
                  </div>
                  </p>
              <!-- Begin Page Content -->




                  <!-- Page Heading -->
<!--                  <h1 class="h3 mb-4 text-gray-800"></h1>-->






          <!-- Begin Page Content -->
          <!--            <div class="container-fluid">-->

    <div class="card shadow mb-4">

          <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary"></h6>

            <div class="card-body">

              <div class="table-responsive">

                <form action="Article" method="get">
                  <table class="table table-bordered" id="dataTable" style="width: 100%"
                         cellspacing="0">
                    <thead>
                    <tr>

                      <th>標題</th>
                      <th>文章分類</th>
                      <th>發文日期</th>
                      <th>照片</th>
                      <th>觀看次數</th>
<!--                        <th>編輯</th>-->
                      <th>刪除</th>
                    </tr>
                    </thead>


                      <tbody>
                    <tr th:each="article: ${articles}">

                      <td><a th:href="@{/User/UserArticle/UserArticleDetail(postid=${article.postid})}" th:text="${ article.title}">
                        ${ article.title}
                      </a></td>
                      <td th:text="${ article.type}"></td>
                      <td th:text="${ article.date}"></td>
                   <td><img th:src="${article.imageUrl}" style="display:block; margin:auto; border-radius:10px;width:100px; height:100px;"></td>
                      <td th:text="${ article.counter}"></td>
<!--                        <td>-->
<!--                            <button type="button" class="btn btn-warning" data-toggle="modal" th:attr="data-target='#UpdateArticle'+${article.postid}" input style="float:right" th:onclick="|updateFunction(${article.postid})|">-->
<!--                                編輯文章-->
<!--                            </button>-->
<!--                        </td>-->
                      <td><button type="button"
                                  class="btn btn-danger"
                                  th:onclick="|archiveFunction(${article.postid})|" id="btn">刪除貼文</button></td>
                      <!--<td><a class="btn btn-danger"
                        href="DeleteArticle?postid=${article.postid}" onclick="del()">刪除貼文</a></td>-->
<!--                        <div class="modal fade" th:id="UpdateArticle+${article.postid}" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">-->
<!--                            <div class="modal-dialog" role="document">-->
<!--                                <div class="modal-content">-->
<!--                                    <div class="modal-header">-->
<!--                                        <h5 class="modal-title" id="ModalLabel">編輯文章</h5>-->
<!--                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
<!--                                            <span aria-hidden="true">&times;</span>-->
<!--                                        </button>-->
<!--                                    </div>-->
<!--                                    <div class="modal-body">-->
<!--                                        <form  method="post" enctype="multipart/form-data" id="updateform">-->
<!--                                            <div class="form-group">-->
<!--&lt;!&ndash;                                                <input type="hidden" name="userId" th:value="${article.user.userId}" id="userId">&ndash;&gt;-->
<!--                                                <input type="hidden" name="postid" th:value="${article.postid}" id="postid">-->
<!--                                                <label for="title">標題:</label>-->
<!--                                                <input type="text" name="title" class="form-control"  id="uptitle" th:value="${article.title}">-->
<!--                                            </div>-->

<!--                                            <div class="form-group">-->
<!--                                                <label for="type">文章分類:</label>-->
<!--                                                <select name="type" class="form-control" id="uptype">-->
<!--                                                    <option value= null label="請選擇分類">請選擇分類</option>-->
<!--                                                    <option value="活動資訊" th:selected="${article.type} == '活動資訊'">活動資訊</option>-->
<!--                                                    <option value="課程資訊" th:selected="${article.type} == '課程資訊'">課程資訊</option>-->
<!--                                                    <option value="食譜討論" th:selected="${article.type} == '食譜討論'">食譜討論</option>-->
<!--                                                </select>-->

<!--                                            </div>-->
<!--                                            <div class="form-group">-->
<!--                                                <label for="date">發文日期:</label>-->
<!--                                                <input type="date" name="date" id="updateDate" th:value="${article.date}">-->
<!--                                            </div>-->
<!--                                            <div class="form-group">-->
<!--                                                <label>內文:</label>-->
<!--                                                <textarea name="content" class="form-control upContent"  id="upContent" cols="30"-->
<!--                                                          rows="10" th:value="${article.content}">[[${article.content}]]</textarea> <br>-->
<!--                                            </div>-->
<!--                                            <div class="form-group">-->
<!--                                                <img th:src="${article.imageUrl}"  width="100" height="100" style="display:block; margin:auto;" id="upPreviewImage"/>-->
<!--                                                <label for="upArticleImage">上傳圖片</label>-->
<!--                                                <input type="file" name="articleImage" class="form-control-file" id="upArticleImage" th:value="${article.imageUrl}">-->
<!--                                            </div>-->

<!--                                        </form>-->
<!--                                    </div>-->
<!--                                    <div class="modal-footer">-->
<!--                                        <button  class="btn btn-outline-warning" id="update">送出文章</button>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->



                    </tr>
                      </tbody>




                  </table>
                </form>
              </div>
            </div>
          </div>
  </div>
        </div>
  <!-- /.container-fluid -->
        </div>
  </div>
  </div>

<!--                    <div class="row" id="container"></div>-->

          <div class="modal fade" id="InsertArticle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">新增文章</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                    <div id='resultMsg' style="height: 18px; font-weight: bold;"></div>
                  <form action="/ArticleAdd"  method="post" enctype="multipart/form-data" id="form">
                    <div class="form-group">
                      <!--                                            <input type="hidden" name="userid"  id="userid">-->
                      <label for="title">標題:</label>
                      <input type="text" name="title" class="form-control"  id="title">
                        <td style="width:200px">
                            <div id='result0c' style="height: 10px;"></div>
                            <br>
                            <div id='result0s' style="height: 10px;"></div>
                        </td>
                    </div>

                    <div class="form-group">
                      <label for="type">文章分類:</label>
                      <select name="type" class="form-control" id="type">
                        <option value= "" label="請選擇分類">請選擇分類</option>
                        <option value="活動資訊">活動資訊</option>
                        <option value="課程資訊">課程資訊</option>
                        <option value="食譜討論">食譜討論</option>
                      </select>
                        <td style="vertical-align: top;width:200px;">
                            <div id='result1c' style="height: 10px;"></div>
                        </td>

                    </div>
                    <div class="form-group">
                      <label for="date">發文日期:</label>
                      <input type="date" name="date" id="date">
                        <td style="vertical-align: top;width:200px;">
                            <div id='result2c' style="height: 10px;"></div>
                        </td>
                    </div>
                    <div class="form-group">
                      <label>內文:</label>
                      <textarea name="content" class="form-control"  id="content" cols="30"
                                rows="10"></textarea> <br>
                        <td style="vertical-align: top;width:200px;">
                            <div id='result3c' style="height: 10px;"></div>
                        </td>
                    </div>
                    <div class="form-group">
                      <img width="100" height="100" style="display:block; margin:auto;" id="previewImage"/>
                      <label for="articleImage">上傳圖片</label>
                      <input type="file" name="articleImage" class="form-control-file" id="articleImage">
                        <td style="vertical-align: top;width:200px;">
                            <div id='result4c' style="height: 10px;"></div>
                        </td>
                    </div>

                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" id="correctInput">一鍵輸入</button>
                  <button type="submit" class="btn btn-outline-warning" id="testAdd">送出文章</button>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-12">
            <div class="product__pagination blog__pagination">
              <a href="#">1</a>
              <a href="#">2</a>
              <a href="#">3</a>
              <a href="#"><i class="fa fa-long-arrow-right"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
 <span>

 </span>
    </div>
  </div>



<!-- Blog Section End -->


<div th:replace="footer.html"></div>



</body>
<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
<!--<script src="//cdnjs.cloudflare.com/ajax/libs/validate.js/0.12.0/validate.min.js"></script>-->
<script>


    function archiveFunction(postid) {
        Swal.fire({
            title: '確定要刪除嗎?',
            text: "刪除後無法復原!",
            icon: 'warning',
            showCancelButton: true,
            cancelButtonText: '取消',
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: '刪除'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '/ArticleDelete/' + postid,
                    type: 'DELETE',
                    success: function (msg) {
                        Swal.fire(
                            '已刪除!',
                            '文章已成功刪除!',
                            'success'
                        ).then((result) => {
                            if (result.isConfirmed) {
                                // location.reload();
                                location = '/User/UserArticle';
                            }
                        })
                    },
                    error: function (msg) {
                        // console.log(msg.status)
                        Swal.fire({
                            icon: 'error',
                            title: '發生錯誤',
                            text: 'HTTP 狀態碼為 ' + msg.status,
                            footer: '<a href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Status"  target="_blank">為什麼會有這個問題?</a>'
                        })
                    }
                });
            }
        })
    }




  var editor; //要先定義
  $('#correctInput').click(function () {

    $('#title').val('烘焙小百科:烘焙材料該怎麼保存？')
    $('#type').val('食譜討論')
    $('#type').niceSelect('update')
    $('#date').val('2022-07-22')
    //$('#content').val('麵粉按照蛋白質含量的高低，又分為高筋麵粉、中筋麵粉、低筋麵粉。')
    editor.setData('麵粉按照蛋白質含量的高低，又分為高筋麵粉、中筋麵粉、低筋麵粉。除此之外，像是抹茶粉、可可粉、芝士粉、杏仁粉、奶粉等等，可以簡單地成為烘焙風味粉，旨在提高產品的風味，讓口感更加豐富另外常見的，還有糯米粉、粘米粉、玉米澱粉、馬鈴薯澱粉、木薯粉等等。上述眾多粉類的保存，都需要放置在避光、陰涼且乾燥的環境中密封保存另外由於這些粉類的強吸附力，應避免與氣味強烈的食材同放和遠離地面減少污染，防止霉變。然後像是一些不太常用的粉類，或者到了夏天特別炎熱的時候，一定要用保鮮盒密封起來放進冰箱冷藏，可以有效保存好這些粉類。');
  })  //ckEditor要加setData才能使用JS一鍵輸入

  ClassicEditor
          .create( document.querySelector( '#content' ) )
          .then( editor => {
            console.log( editor );
            window.editor = editor;//一鍵輸入要加
            editor = editor;//一鍵輸入要加
          } )
          .catch( error => {
            console.error( error );
          } );




  $(document).ready(function(){
    $("body").on("change", "#articleImage", function(e){
      var file = e.target.files[0];
      var mediabase64data;
      getBase64(file).then(
              mediabase64data => $('#previewImage').attr('src', mediabase64data)
      );
    });
  })

  function getBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
    });
  }



  // $('#testadd').click(function (event) {
  //     event.preventDefault();
  //     add();
  // })



  // function add() {

      var testAdd = document.getElementById("testAdd");
      testAdd.onclick = function() {

          const editorData = editor.getData(); //ckEditor要加getData，Ajax傳輸才能取到值
          var formData = new FormData($('#form')[0]);
          formData.append('content', editorData)   //append要用是附加傳資料

          var title = document.getElementById("title").value;
          var type = document.getElementById("type").value;
          var date = document.getElementById("date").value;
          var content = document.getElementById("content").value;
          var articleImage = document.getElementById("articleImage").value;


          var hasError = false; // 設定判斷有無錯誤的旗標
          var div0 = document.getElementById('result0c');
          var div1 = document.getElementById('result1c');
          var div2 = document.getElementById('result2c');
          var div3 = document.getElementById('result3c');
          var div4 = document.getElementById('result4c');
          var divResult = document.getElementById('resultMsg');
          if (!title) {
              div0.innerHTML = "<p class='wrong'>請輸入標題</p>";
              hasError = true;
          } else {
              div0.innerHTML = "";
          }
          if (!type) {
              div1.innerHTML = "<p class='wrong'>請選擇分類</p>";
              hasError = true;
          } else {
              div1.innerHTML = "";
          }
          if (!date) {
              div2.innerHTML = "<p class='wrong'>請輸入日期</p>";
              hasError = true;
          } else {
              div2.innerHTML = "";
          }
          if (!editorData) {
              div3.innerHTML = "<p class='wrong'>請輸入內文</p>";
              hasError = true;
          } else {
              div3.innerHTML = "";
          }
          if (!articleImage) {
              div4.innerHTML = "<p class='wrong'>請放入照片</p>";
              hasError = true;
          } else {
              div4.innerHTML = "";
          }
          if (hasError) {
              return false;
          }
          //console.log(formData)
          $.ajax({
              url: "[[@{/ArticleAdd}]]",
              data: formData,
              type: "post",
              cache: false, // 不需要cache
              processData: false, // jQuery預設會把data轉為query String, 所以要停用
              contentType: false,
              enctype: 'multipart/form-data',
              // dataType: "json",
              // contentType: "application/json;charset=utf-8",
              success: function (result) {
                  // loadData();
                  // console.log(111111)
                  $('#InsertArticle').modal('hide');
                  window.location.reload();
              },
              error: function (errormessage) {
                  alert(errormessage.responseText);
              }
          });


      }


</script>

</html>