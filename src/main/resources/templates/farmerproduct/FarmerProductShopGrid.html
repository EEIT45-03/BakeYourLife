<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Ogani Template">
    <meta name="keywords" content="Ogani, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>小農商品</title>

    <div th:replace="css.html"></div>
    <link rel="stylesheet" href="/css/supplier.css" type="text/css">
    <style>
        .imgBlock {
            margin: 0 auto;
        }

        .profile {
            padding: 15px;
            /*height: 200px;*/
        }

        .profile-card {
            height: 200px;
            position: relative;
            overflow: hidden;
            margin-bottom: 10px;
            box-shadow: rgba(17, 17, 26, 0.1) 0px 4px 16px, rgba(17, 17, 26, 0.05) 0px 8px 32px;
            border-radius: 20px;
        }

        .profile-card:hover .profile-img img {
            transform: scale(1.2);
        }

        .profile-card .profile-img img {
            width: 70%;
            height: 200px;
            object-fit: cover;
            transition: transform 1s;
        }


        .profile-card .profile-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 200px;
            padding: 50% 4%;
            text-align: center;

        }

        .profile-card .profile-content:hover {
            background-color: rgba(64, 115, 53, 0.8);
        }

        .profile-card .profile-content .title {
            font-weight: bolder;
            font-size: 24px;
            color: #fff;
            text-shadow: black 0.1em 0.1em 0.2em;
            opacity: 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            transform: translateY(-100px);
            transition: all 500ms cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.10s;
        }

        .profile-card:hover .title {
            opacity: 1;
            transform: translateY(-60px);
        }

        .profile-card:hover .title::after {
            content: "";
            display: block;
            width: 50%;
            margin: 10px auto;
            border-bottom: 2px solid #fff;
        }

        .profile-card .profile-content .title > span {
            display: block;
            margin: 5px 0;
            font-size: 14px;
            text-transform: capitalize;
        }


    </style>

</head>

<body>
<div th:replace="header.html"></div>
<!--<div th:replace="menu.html"></div>-->


<!-- Product Section Begin -->
<section class="product spad">
    <div class="container">
        <div class="product__discount">
            <div class="section-title from-blog__title">
                <h2>小農廠商</h2>
            </div>

            <div class="row">

                <div class="product__discount__slider owl-carousel">
                    <a th:href="@{ShopGrid/{farmetId}(farmetId=${farmer.farmerId})}" th:each=" farmer:${farmerList}">
                        <div class="col-lg-4 profile">
                            <div class="profile-card">
                                <div class="profile-img ">
                                    <img class="imgBlock" th:src="${farmer.imageUrl}">
                                </div>
                                <div class="profile-content">
                                    <h2 class="title"> 前往賣場 <i class="fa-solid fa-angles-right"></i></h2>
                                </div>
                            </div>
                        </div>
                    </a>

                </div>
            </div>
        </div>
        <hr>
        <div class="section-title from-blog__title">
            <h2>小農商品</h2>
        </div>
        <div class="row">
            <div class="col-lg-3 col-md-5">
                <div class="sidebar">
                    <div class="sidebar__item">
                        <h4>商品類型</h4>
                        <ul>
                            <li><a th:onclick='showByType("全部")'>全部</a></li>
                            <li><a th:onclick='showByType("蔬菜類")'>蔬菜類</a></li>
                            <li><a th:onclick='showByType("水果類")'>水果類</a></li>
                            <li><a th:onclick='showByType("牛奶類")'>牛奶類</a></li>
                            <li><a th:onclick='showByType("茶葉類")'>茶葉類</a></li>
                            <li><a th:onclick='showByType("咖啡豆類")'>咖啡豆類</a></li>
                        </ul>
                    </div>

                    <div class="sidebar__item">
                        <div class="latest-product__text"
                             th:if="${not #lists.isEmpty(topSixList)} and ${topSixList.size()} >= 6">
                            <h4>熱銷商品</h4>
                            <div class="latest-product__slider owl-carousel">
                                <div class="latest-prdouct__slider__item">
                                    <a th:href="@{/FarmerProductShop/ShopDetails/{farmerProductId}(farmerProductId=${topSixList[0].farmerProductId})}"
                                       class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img th:src="${topSixList[0].farmerProductPicList[0].pictureLink}" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <span>Top 1</span>
                                            <h6 th:text="${topSixList[0].name}"></h6>
                                            <span th:text="|NT$${topSixList[0].price}|"></span>
                                        </div>
                                    </a>
                                    <a th:href="@{/FarmerProductShop/ShopDetails/{farmerProductId}(farmerProductId=${topSixList[1].farmerProductId})}"
                                       class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img th:src="${topSixList[1].farmerProductPicList[0].pictureLink}" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <span>Top 2</span>
                                            <h6 th:text="${topSixList[1].name}"></h6>
                                            <span th:text="|NT$${topSixList[1].price}|"></span>
                                        </div>
                                    </a>
                                    <a th:href="@{/FarmerProductShop/ShopDetails/{farmerProductId}(farmerProductId=${topSixList[2].farmerProductId})}"
                                       class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img th:src="${topSixList[2].farmerProductPicList[0].pictureLink}" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <span>Top 3</span>
                                            <h6 th:text="${topSixList[2].name}"></h6>
                                            <span th:text="|NT$${topSixList[2].price}|"></span>
                                        </div>
                                    </a>

                                </div>
                                <div class="latest-prdouct__slider__item">
                                    <a th:href="@{/FarmerProductShop/ShopDetails/{farmerProductId}(farmerProductId=${topSixList[3].farmerProductId})}"
                                       class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img th:src="${topSixList[3].farmerProductPicList[0].pictureLink}" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <span>Top 4</span>
                                            <h6 th:text="${topSixList[3].name}"></h6>
                                            <span th:text="|NT$${topSixList[3].price}|"></span>
                                        </div>
                                    </a>
                                    <a th:href="@{/FarmerProductShop/ShopDetails/{farmerProductId}(farmerProductId=${topSixList[4].farmerProductId})}"
                                       class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img th:src="${topSixList[4].farmerProductPicList[0].pictureLink}" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <span>Top 5</span>
                                            <h6 th:text="${topSixList[4].name}"></h6>
                                            <span th:text="|NT$${topSixList[4].price}|"></span>
                                        </div>
                                    </a>
                                    <a th:href="@{/FarmerProductShop/ShopDetails/{farmerProductId}(farmerProductId=${topSixList[5].farmerProductId})}"
                                       class="latest-product__item">
                                        <div class="latest-product__item__pic">
                                            <img th:src="${topSixList[5].farmerProductPicList[0].pictureLink}" alt="">
                                        </div>
                                        <div class="latest-product__item__text">
                                            <span>Top 6</span>
                                            <h6 th:text="${topSixList[5].name}"></h6>
                                            <span th:text="|NT$${topSixList[5].price}|"></span>
                                        </div>
                                    </a>

                                </div>

                            </div>
                        </div>
                    </div>


                </div>
            </div>

            <!--         右邊-->
            <div class="col-lg-9 col-md-7">

                <!--              右邊下面的排序那排開始-->


                <div class="row">

                    <div class="col-lg-4 col-md-4">
                        <div class="filter__found" id="countDiv">
                            <!--                            <h6>共&nbsp;<span th:text="${farmerProductBeanList.size()}"></span>&nbsp;項商品</h6>-->
                        </div>
                    </div>

                </div>
                <!--              右邊下面的商品開始-->
                <div class="row" id="productContent">
                    <!--                    <div class="col-lg-4 col-md-6 col-sm-6" th:each="bean:${farmerProductBeanList}">-->
                    <!--                        <div class="product__item">-->
                    <!--                            <div class="product__item__pic set-bg"-->
                    <!--                                 th:data-setbg="${not #lists.isEmpty(bean.farmerProductPicList)}?${bean.farmerProductPicList[0].pictureLink }:'/img/logo6.png'">-->
                    <!--                                <ul class="product__item__pic__hover">-->
                    <!--                                    <li><a href="#"><i class="fa fa-heart"></i></a></li>-->
                    <!--                                    <li><a href="#"><i class="fa fa-retweet"></i></a></li>-->
                    <!--                                    <li><a href="#" th:onclick="|add('F',${bean.farmerProductId})|"><i-->
                    <!--                                            class="fa fa-shopping-cart"></i></a></li>-->
                    <!--                                </ul>-->
                    <!--                            </div>-->
                    <!--                            <div class="product__item__text">-->
                    <!--                                <h6>-->
                    <!--                                    <a th:href="@{ShopDetails/{farmerProductId}(farmerProductId=${bean.farmerProductId})}"-->
                    <!--                                       th:text="${bean.name}"></a>-->
                    <!--                                </h6>-->
                    <!--                                <h5 th:text="|NT$${bean.price}|"></h5>-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                </div>
                <!--                    分頁-->
                <div class="d-flex justify-content-center">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination" id="pageid">
                        </ul>
                    </nav>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Product Section End -->

<div th:replace="footer.html"></div>

<script>

    //塞資料的地方
    const content = document.getElementById('productContent');
    //塞頁數的地方
    const pageid = document.getElementById('pageid');
    //存資料
    let jsonData = {};


    $(document).ready(function () {
        showByType("全部");
    });


    //類型
    function showByType(type) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", '[[@{/FarmerProducts/}]]' + type, true);
        xhr.send();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                let result = JSON.parse(xhr.responseText);
                $("#countDiv").html(`<h6>共&nbsp;&nbsp;<span>${result.length}</span>項商品</h6>`)
                jsonData = result;
                pagination(jsonData, 1);
            } else if (xhr.status === 400) {
                Swal.fire(
                    '錯誤!',
                    json.message,
                    'error'
                )
            }
        }

    }

    //分頁
    function pagination(jsonData, nowPage) {
        console.log(nowPage);
        // 取得全部資料長度
        const dataTotal = jsonData.length;

        // 設定要顯示在畫面上的資料數量
        // 預設每一頁只顯示 6 筆資料。
        const perpage = 6;

        // page 按鈕總數量公式 總資料數量 / 每一頁要顯示的資料
        // 這邊要注意，因為有可能會出現餘數，所以要無條件進位。
        const pageTotal = Math.ceil(dataTotal / perpage);

        // 當前頁數，對應現在當前頁數
        let currentPage = nowPage;

        // 因為要避免當前頁數筆總頁數還要多，假設今天總頁數是 3 筆，就不可能是 4 或 5
        // 所以要在寫入一個判斷避免這種狀況。
        // 當"當前頁數"比"總頁數"大的時候，"當前頁數"就等於"總頁數"
        // 注意這一行在最前面並不是透過 nowPage 傳入賦予與 currentPage，所以才會寫這一個判斷式，但主要是預防一些無法預期的狀況，例如：nowPage 突然發神經？！
        if (currentPage > pageTotal) {
            currentPage = pageTotal;
        }

        // 由前面可知 最小數字為 6 ，所以用答案來回推公式。
        const minData = (currentPage * perpage) - perpage + 1;
        const maxData = (currentPage * perpage);

        // 先建立新陣列
        const data = [];
        // 這邊將會使用 ES6 forEach 做資料處理
        // 首先必須使用索引來判斷資料位子，所以要使用 index
        jsonData.forEach((item, index) => {
            // 獲取陣列索引，但因為索引是從 0 開始所以要 +1。
            const num = index + 1;
            // 這邊判斷式會稍微複雜一點
            // 當 num 比 minData 大且又小於 maxData 就push進去新陣列。
            if (num >= minData && num <= maxData) {
                data.push(item);
            }
        })
        // 用物件方式來傳遞資料
        const page = {
            pageTotal,
            currentPage,
            hasPage: currentPage > 1,
            hasNext: currentPage < pageTotal,
        }
        displayData(data);
        pageBtn(page);
    }

    //顯示資料
    function displayData(data) {
        let str = '';
        data.forEach((item) => {
            str += `<div class="col-lg-4 col-md-6 col-sm-6" >
                         <div class="product__item">
                             <div class="product__item__pic set-bg" style="background-image: url('${item.farmerProductPicList[0].pictureLink}')">
                                 <ul class="product__item__pic__hover">
                                     <li><a href="/FarmerProductShop/ShopDetails/${item.farmerProductId}"><i class="fa fa-magnifying-glass"></i></a></li>
                                     <li><a href="#" onclick="add('F',${item.farmerProductId})"><i class="fa fa-shopping-cart"></i></a></li>
                                 </ul>
                             </div>
                             <div class="product__item__text">
                                 <h6><a href="/FarmerProductShop/ShopDetails/${item.farmerProductId}">${item.name}</a>
                                 </h6>
                                 <h5 >NT$${item.price}</h5>
                             </div>
                         </div>
                     </div>`;
        });
        content.innerHTML = str;
    }

    //產生頁數
    function pageBtn(page) {
        let str = '';
        const total = page.pageTotal;
        //上一頁
        if (page.hasPage) {
            str += `<li class="page-item"><a class="page-link" href="#" data-page="${Number(page.currentPage) - 1}"><i class="fa-solid fa-angle-left"></i></a></li>`;
        } else {
            str += `<li class="page-item disabled"><span class="page-link"><i class="fa-solid fa-angle-left"></i></span></li>`;
        }

        //頁數
        for (let i = 1; i <= total; i++) {
            if (Number(page.currentPage) === i) {
                str += `<li class="page-item active"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
            } else {
                str += `<li class="page-item"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
            }
        }
        ;
        //下一頁
        if (page.hasNext) {
            str += `<li class="page-item"><a class="page-link" href="#" data-page="${Number(page.currentPage) + 1}"><i class="fa-solid fa-angle-right"></i></a></li>`;
        } else {
            str += `<li class="page-item disabled"><span class="page-link"><i class="fa-solid fa-angle-right"></i></span></li>`;
        }

        pageid.innerHTML = str;
    }

    function switchPage(e) {
        e.preventDefault();
        if (e.target.nodeName !== 'A') return;
        const page = e.target.dataset.page;
        pagination(jsonData, page);
    }

    pageid.addEventListener('click', switchPage);


</script>


</body>

</html>