<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Ogani Template">
    <meta name="keywords" content="Ogani, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>租借場地</title>

    <div th:replace="css.html"></div>
    <style>
        .img {
            border-radius: 5px;
            object-fit: cover;

        }

        .product__details__pic__item--large {

            max-height: 500px;
        }

        .smallimg .owl-item {
            object-fit: cover;
            width: 125px;
            height: 100px;
        }

        .userimg {
            width: 120px;
            height: 90px;
        }

        body {
            margin-top: 20px;
        }

        .content-item {
            padding: 30px 0;
            background-color: #FFFFFF;
        }

        .content-item.grey {
            background-color: #F0F0F0;
            padding: 50px 0;
            height: 100%;
        }

        .content-item h2 {
            font-weight: 700;
            font-size: 35px;
            line-height: 45px;
            text-transform: uppercase;
            margin: 20px 0;
        }

        .content-item h3 {
            font-weight: 400;
            font-size: 20px;
            color: #555555;
            margin: 10px 0 15px;
            padding: 0;
        }

        .content-headline {
            height: 1px;
            text-align: center;
            margin: 20px 0 70px;
        }

        .content-headline h2 {
            background-color: #FFFFFF;
            display: inline-block;
            margin: -20px auto 0;
            padding: 0 20px;
        }

        .grey .content-headline h2 {
            background-color: #F0F0F0;
        }

        .content-headline h3 {
            font-size: 14px;
            color: #AAAAAA;
            display: block;
        }


        #comments {
            box-shadow: 0 -1px 6px 1px rgba(0, 0, 0, 0.1);
            background-color: #FFFFFF;
        }

        #comments form {
            margin-bottom: 30px;
        }

        #comments .btn {
            margin-top: 7px;
        }

        #comments form fieldset {
            clear: both;
        }

        #comments form textarea {
            height: 100px;
        }

        #comments .media {
            border-top: 1px dashed #DDDDDD;
            padding: 20px 0;
            margin: 0;
        }

        #comments .media > .pull-left {
            margin-right: 20px;
        }

        #comments .media img {
            max-width: 100px;
        }

        #comments .media h4 {
            margin: 0 0 10px;
        }

        #comments .media h4 span {
            font-size: 14px;
            float: right;
            color: #999999;
        }

        #comments .media p {
            margin-bottom: 15px;
            text-align: justify;
        }

        #comments .media-detail {
            margin: 0;
        }

        #comments .media-detail li {
            color: #AAAAAA;
            font-size: 12px;
            padding-right: 10px;
            font-weight: 600;
        }

        #comments .media-detail a:hover {
            text-decoration: underline;
        }

        #comments .media-detail li:last-child {
            padding-right: 0;
        }

        #comments .media-detail li i {
            color: #666666;
            font-size: 15px;
            margin-right: 10px;
        }

        .star {
            color: #ffbf00;
        }

        .product__details__tab {
            padding-top: 30px;
        }

        .blog__details__content {
            border: solid 1px #b4b9bd;
            border-radius: 20px;
            padding: 10px;
            margin-top: 15px;
        }

        .product__details__text ul {
            margin-top: 15px;
            padding-top: 15px;
        }

        .farmer {
            white-space: nowrap;
            display: flex;
            align-items: center;
        }

        .main_btn {
            padding: 0px 30px;
            background: #f42f2c;
            z-index: 2;
            display: inline-block;
            transition: all 400ms linear;
            text-align: center;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            line-height: 48px;
            border: 1px solid #f42f2c;
            border-radius: 5px;
            transition: all 300ms linear 0s;
            text-transform: capitalize;
            box-shadow: -10px 10px 40px rgba(244, 47, 44, 0.32); }
        .main_btn:hover {
            background: transparent;
            color: #f42f2c;
            box-shadow: none; }


    </style>

</head>

<body>
<div th:replace="header.html"></div>
<div th:replace="menu.html"></div>

<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-section set-bg" data-setbg="/img/breadcrumb.jpg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb__text">
                    <h2>租借場地</h2>
                    <div class="breadcrumb__option">
                        <!--                        <a href="./index.html">Home</a>-->
                        <!--                        <a href="./index.html">Vegetables</a>-->
                        <!--                        <span>Vegetable’s Package</span>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- Product Details Section Begin -->
<section class="product-details spad">
    <div class="container" th:object="${venueBean}">
        <div class="row">
            <div class="col-lg-6 col-md-6 imgBlock">
                <div th:if="${not #lists.isEmpty(venueBean.venuePicList)}"
                     class="product__details__pic">
                    <div class="product__details__pic__item">
                        <img class="img product__details__pic__item--large"
                             th:src="*{venuePicList[0].picture}" alt="">
                    </div>
                    <div class=" product__details__pic__slider owl-carousel">
                        <img class="img smallimg" th:each="pic : *{venuePicList}"
                             th:data-imgbigurl="${pic.picture}"
                             th:src="${pic.picture}" alt="">

                    </div>
                </div>
                <div th:unless="${not #lists.isEmpty(venueBean.venuePicList)}"
                     class="product__details__pic">
                    <div class="product__details__pic__item">
                        <img class="img product__details__pic__item--large"
                             src="/img/logo6.png" alt="">
                    </div>

                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <div class="product__details__text">
                    <h3 th:text="*{venueName}" id="venue"></h3>
                    <div class="product__details__rating">
                        <!--                        <i class="fa fa-star"></i>-->
                        <!--                        <i class="fa fa-star"></i>-->
                        <!--                        <i class="fa fa-star"></i>-->
                        <!--                        <i class="fa fa-star"></i>-->
                        <!--                        <i class="fa fa-star-half-o"></i>-->
                        <!--                        <span>(18 reviews)</span>-->
                    </div>
                    <div class="product__details__price"> 一小時 NT$<span id="pri" th:text="*{hrPrice}"></span></div>

                    <!--                    <div class="product__details__quantity">-->
                    <!--                        -->
                    <!--                        <div class="quantity">-->
                    <!--                            <div class="pro-qty">-->
                    <!--                                <input type="text" value="1">-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <!--                    <a href="#" class="primary-btn" th:onclick="|add('F',*{farmerProductId})|">加入購物車</a>-->
                    <!--                    <a href="#" class="heart-icon"><span class="icon_heart_alt"></span></a>-->
                    <ul>
                        <li><b>種類:</b> <span id="type" th:text="*{venueSort.sort}"></span></li>
                        <li><b>數量:</b> <span id="max" th:text="*{personMax}"></span><span>組</span></li>
                    </ul>
                    <hr>

                    <table>
                        <tr>
                            <th><label  for="dateSel">查詢日期: </label></th>
                            <th><input type="date" name="dateSel" id="dateSel"></th>
                        </tr>
                        <tr>
                            <th><label for="periodSel">時段: </label></label></th>
                            <th><select type="text" name="periodSel" id="periodSel">
                                <option value="" selected>請選擇</option>
                                <option value="08:00-12:00">08:00-12:00</option>
                                <option value="12:00-16:00">12:00-16:00</option>
                                <option value="16:00-20:00">16:00-20:00</option>
                                <option value="08:00-16:00">08:00-16:00</option>
                                <option value="12:00-20:00">12:00-20:00</option>
                                <option value="08:00-20:00">08:00-20:00</option>
                            </select></th>
                        </tr>
                    </table>
                    <p id="useSel"></p>
                    <span class="product__details__quantity">
                        <span class="quantity">
                            <span class="pro-qty">
                                <input type="text" id="num" value="1">
                            </span>
                        </span>
                    </span>
                    <span>
                    <a class="main_btn" id="but_insert">
                        <i class="fas fa-fw fa-shopping-cart"></i><span>加入租借單</span></a>
                    </span>
                </div>
            </div>


            <div class="col-lg-12">
                <div class="product__details__tab">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab"
                               aria-selected="true"><h4>介紹</h4></a>
                        </li>
                        <!--                        <li class="nav-item">-->
                        <!--                            <a class="nav-link" data-toggle="tab" href="#tabs-2" role="tab"-->
                        <!--                               aria-selected="false">商品評價</a>-->
                        <!--                        </li>-->

                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tabs-1" role="tabpanel">
                            <div class="product__details__tab__desc">
                                <h6>器材介紹</h6>
                                <p th:utext="${#strings.replace(#strings.escapeXml(venueBean.notes),'&#10;','&lt;br&gt;')}"></p>
                            </div>
                        </div>
                        <!--                        <div class="tab-pane" id="tabs-2" role="tabpanel">-->
                        <!--                            <div class="product__details__tab__desc">-->
                        <!--                                <h6>商品評價</h6>-->

                        <!--                                <section class="content-item" id="comments">-->
                        <!--                                    <div class="container">-->
                        <!--                                        <div class="row">-->
                        <!--                                            <div class="col-sm-8">-->
                        <!--                                                &lt;!&ndash; COMMENT 1 - START &ndash;&gt;-->
                        <!--                                                <div class="media" th:each="comment :*{productCommentList}">-->
                        <!--                                                    <a class="pull-left" href="#">-->
                        <!--                                                        <img class="img userimg media-object"-->
                        <!--                                                             src="/img/undraw_profile.svg"-->
                        <!--                                                             alt=""></a>-->
                        <!--                                                    <div class="media-body">-->
                        <!--                                                        <h4 class="media-heading" th:text="${comment.user.username}">-->
                        <!--                                                            John Doe</h4>-->
                        <!--                                                        <span th:switch="${comment.star}" class="star">-->
                        <!--                                                               <span th:case="1">-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                               </span>-->
                        <!--                                                            <span th:case="2">-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                               </span>-->
                        <!--                                                            <span th:case=3>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                               </span>-->
                        <!--                                                            <span th:case="4">-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                               </span>-->
                        <!--                                                            <span th:case="5">-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                                  <i class="fa-solid fa-star"></i>-->
                        <!--                                                               </span>-->
                        <!--                                                        </span>-->
                        <!--                                                        &lt;!&ndash;                                                        <p th:text="${comment.commentContent}"></p>&ndash;&gt;-->
                        <!--                                                        <p th:utext="${#strings.replace(#strings.escapeXml(comment.commentContent),'&#10;','&lt;br&gt;')}"></p>-->


                        <!--                                                        <ul class="list-unstyled list-inline media-detail pull-left">-->
                        <!--                                                            <li><i class="fa fa-calendar"></i>-->
                        <!--                                                                <span th:text=" ${#dates.format(comment.time, 'yyyy/MM/dd HH:mm')}"></span>-->
                        <!--                                                            </li>-->

                        <!--                                                        </ul>-->
                        <!--                                                        &lt;!&ndash;                                                        <ul class="list-unstyled list-inline media-detail pull-right">&ndash;&gt;-->
                        <!--                                                        &lt;!&ndash;                                                            <li class=""><a href="">Like</a></li>&ndash;&gt;-->
                        <!--                                                        &lt;!&ndash;                                                            <li class=""><a href="">Reply</a></li>&ndash;&gt;-->
                        <!--                                                        &lt;!&ndash;                                                        </ul>&ndash;&gt;-->
                        <!--                                                    </div>-->
                        <!--                                                </div>-->
                        <!--                                                &lt;!&ndash; COMMENT 1 - END &ndash;&gt;-->


                        <!--                                            </div>-->
                        <!--                                        </div>-->
                        <!--                                    </div>-->
                        <!--                                </section>-->
                        <!--                            </div>-->
                        <!--                        </div>-->

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Product Details Section End -->

<!-- Related Product Section Begin -->
<!--<section class="related-product">-->
<!--    <div class="container">-->
<!--        <div class="row">-->
<!--            <div class="col-lg-12">-->
<!--                <div class="section-title related__product__title">-->
<!--                    <h2>推薦商品</h2>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div class="row" id="productContent">-->


<!--        </div>-->
<!--    </div>-->
<!--</section>-->
<!--&lt;!&ndash; Related Product Section End &ndash;&gt;-->

<div th:replace="footer.html"></div>

<script>

    $(document).ready(function () {

        var time = new Date();
        var time = new Date();
        var day = ("0" + time.getDate()).slice(-2);
        var month = ("0" + (time.getMonth() + 1)).slice(-2);
        var today = time.getFullYear() + "-" + (month) + "-" + (day);
        $('#dateSel').val(today).attr('min',today);


        $('#dateSel').on('change',function (){
            var name = $('#venue').text();
            var max = $('#max').text();
            var date = $('#dateSel').val();
            var period = $('#periodSel').val();
            getVenueSelect(name,date,period,max);
        })
        $('#periodSel').on('change',function (){
            var name = $('#venue').text();
            var max = $('#max').text();
            var date = $('#dateSel').val();
            var period = $('#periodSel').val();
            getVenueSelect(name,date,period,max);
        })
        $('#but_insert').on('click',function (){
            var name = $('#venue').text();
            var date = $('#dateSel').val();
            var period = $('#periodSel').val();
            var num = $('#num').val();
            var rem = $('#rem').text();
            var pri = $('#pri').text();
            getCeateRentalVenue(name,date,period,num,pri,rem);
        })


    })


    function getVenueSelect(name,date,period,max){
        fetch("/VenueSelect/"+name+"/"+date).then(response =>{
            if (!response.ok) {
                // make the promise be rejected if we didn't get a 2xx response
                const err = new Error("Not 2xx response");
                err.response = response;
                throw err;
            } else {
                return response.json()
            }
        }).then(data => {
                let num = 0;
                if(data.length >0){

                    let numArray = [0,0,0,0,0,0];
                    for (let per of data) {
                        if (per.label == "08:00-12:00") {
                            numArray[0] = per.value;
                        }
                        if (per.label == "12:00-16:00") {
                            numArray[1] = per.value;
                        }
                        if (per.label == "16:00-20:00") {
                            numArray[2] = per.value;
                        }
                        if (per.label == "08:00-16:00") {
                            numArray[3] = per.value;
                        }
                        if (per.label == "12:00-20:00") {
                            numArray[4] = per.value;
                        }
                        if (per.label == "08:00-20:00") {
                            numArray[5] = per.value;
                        }
                    }
                    if (period.length > 0) {
                        if (period == "08:00-12:00") {
                            num = max - (numArray[0] + numArray[3] + numArray[5]);
                        }
                        if (period == "12:00-16:00") {
                            num = max - (numArray[1] + numArray[3] + numArray[4] + numArray[5]);
                        }
                        if (period == "16:00-20:00") {
                            num = max - (numArray[2] + numArray[4] + numArray[5]);
                        }
                        if (period == "08:00-16:00") {
                            num = max - (numArray[0] + numArray[1] + numArray[3] + numArray[4] + numArray[5]);
                        }
                        if (period == "12:00-20:00") {
                            num = max - (numArray[1] + numArray[2] + numArray[3] + numArray[4] + numArray[5]);
                        }
                        if (period == "08:00-20:00") {
                            num = max - (numArray[0] + numArray[1] + numArray[2] + numArray[3] + numArray[4] + numArray[5]);
                        }
                        $('#useSel').html('<span>剩餘</span><span id="rem">'+num+'</span><span>組位置可使用</span>');
                    } else {
                        $('#useSel').html('請選擇使用時段');
                    }

                } else {
                    if(period.length > 0) {
                        num = max
                        $('#useSel').html('<span>剩餘</span><span id="rem">' + num + '</span><span>組位置可使用</span>');
                    } else {
                        $('#useSel').html('請選擇使用時段');
                    }
                }
        }).catch(function (err){
            console.log('Error:'+(err))
        })
    };

    function getCeateRentalVenue(name,date,period,num,pri,rem){

        if(rem>=num && num != 0) {
            let hr1 = period.substring(0,2)
            let hr2 = period.substring(6,8)
            let price = (hr2-hr1)*num*pri;
            console.log(price)
            let venueListRequest = {
                "venueName": name,
                "rentalDate": date,
                "period": period,
                "person": num,
                "price": price
            }
            $.ajax({
                url: "/inertVenueList",
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(venueListRequest),
                success: function () {
                    Swal.fire(
                        '新增成功!',
                        '以新增到租借單!',
                        'success'
                    ).then((result) => {
                        if (result.isConfirmed) {
                            location.reload();
                        }
                    })
                },
                error: function (err) {
                    console.log("error=" + err)
                }
            })
        } else {
            if(rem != "" && rem !== undefined){
                Swal.fire(
                    '此場地位置不夠,剩餘'+rem+'組位置',
                    '',
                    'warning'
                )
            } else {
                Swal.fire(
                    '請先選擇使用時段',
                    '',
                    'warning'
                )
            }
            return false;
        }
    }


</script>


</body>

</html>